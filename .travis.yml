language: scala

scala: 2.11.7

sudo: required

services:
  - docker

before_install:
  - openssl aes-256-cbc -K $encrypted_bd976e462827_key -iv $encrypted_bd976e462827_iv  -in ./dist/.dropbox_uploader.enc -out dropbox_uploader -d
  - docker pull cheminotorg/dbtest:latest
  - docker run -d -p 127.0.0.1:7474:7474 cheminotorg/dbtest
  - docker ps -a
  - sleep 10

script:
  - chmod a+x ./docker/test/changepassword.sh
  - ./docker/test/changepassword.sh
  - sbt test
  - sbt one-jar
  - chmod a+x ./dist/upload.sh
  - dist/upload.sh

deploy:
  provider: releases
  api_key:
    secure: VZ2aXVwwsEm/XQrrL2WewNewSYrjYhqlzc7hOg1lr3ak+2irJ/PpZbOZ0TPjqETlP6HKMwHBRWWnNlOJXggQ3bcUE1Yop3BasOIuJz212pwdkM6Dupi6G9iRDz9TnZ9fmXrqv8y8dJEd4Lw4fzL9vVnixtgaaDSdG+AWs7xg5yE=
  file: target/*one-jar.jar
  on:
    repo: cheminotorg/cheminot.org
    tag: true
